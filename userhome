#!/usr/bin/env bash
# Печатает помощь
usage(){
  cat <<EOF
Usage: userhome [-f file] [username]
  -f file   Use file instead of /etc/passwd
  --help    Show this help
If username is omitted, current user (\$(whoami)) is used.
EOF
}

FILE="/etc/passwd"
USER=""
# Если кол-во аргументов > 0
while [[ $# -gt 0 ]]; do
  case "$1" in
    --help|--usage)
      usage; exit 0;;
            # вывели хелп
    -f)
      shift
      [[ -z "$1" ]] && { echo "Missing argument for -f" >&2; usage; exit 0; }
      FILE="$1"; shift;;
    --)
      shift; break;;
    -*)
      echo "Unsupported option: $1" >&2; usage; exit 0;;
    *)
      if [[ -z "$USER" ]]; then
        USER="$1"
        shift
      else
        echo "Too many arguments" >&2; usage; exit 0
      fi;;
  esac
done

if [[ -z "$USER" ]]; then
  USER="$(whoami)"
fi

if [[ ! -f "$FILE" ]]; then
  echo "File not found: $FILE" >&2
  exit 2
fi

line="$(grep -m1 -E "^${USER}:" -- "$FILE")"
if [[ -z "$line" ]]; then
  echo "User not found: $USER" >&2
  exit 1
fi

home="$(echo "$line" | cut -d: -f6)"
echo "$home"
exit 0
